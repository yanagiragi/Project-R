1. main part of ragi's algorithm
2. missing anderson's part